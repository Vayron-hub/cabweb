<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8 p-5 bg-white rounded-xl shadow-sm">
  <div class="statistics-title">
    <h2 class="text-2xl font-semibold text-gray-800 mb-1">Estadísticas</h2>
    <p class="text-sm text-gray-600">Análisis general de datos para {{selectedLocation}}</p>
  </div>
  <div>
    <button class="flex items-center gap-2 px-4 py-2 bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-200 rounded-lg font-medium transition-colors duration-200" 
            (click)="refreshStatistics()" [disabled]="isLoadingStats">
      <i class="pi" [class.pi-refresh]="!isLoadingStats" [class.pi-spin]="isLoadingStats"
        [class.pi-spinner]="isLoadingStats"></i>
      {{isLoadingStats ? 'Actualizando...' : 'Actualizar'}}
    </button>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
  <div class="bg-white rounded-xl p-6 shadow-sm flex items-center gap-4 hover:shadow-md transition-all duration-200 transform hover:-translate-y-1" 
       *ngIf="estadisticasGenerales">
    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
      <i class="pi pi-chart-line text-blue-600 text-xl"></i>
    </div>
    <div class="kpi-content">
      <span class="block text-2xl font-bold text-gray-800">{{estadisticasGenerales.totalDetecciones}}</span>
      <span class="text-sm text-gray-600">Total Detecciones</span>
    </div>
  </div>

  <div class="bg-white rounded-xl p-6 shadow-sm flex items-center gap-4 hover:shadow-md transition-all duration-200 transform hover:-translate-y-1">
    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
      <i class="pi pi-desktop text-green-600 text-xl"></i>
    </div>
    <div class="kpi-content">
      <span class="block text-2xl font-bold text-gray-800">{{getActiveClassifiersCount()}}</span>
      <span class="text-sm text-gray-600">Clasificadores Activos</span>
    </div>
  </div>

  <div class="bg-white rounded-xl p-6 shadow-sm flex items-center gap-4 hover:shadow-md transition-all duration-200 transform hover:-translate-y-1">
    <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
      <i class="pi pi-map text-orange-600 text-xl"></i>
    </div>
    <div class="kpi-content">
      <span class="block text-2xl font-bold text-gray-800">{{getActiveZonesCount()}}</span>
      <span class="text-sm text-gray-600">Zonas Activas</span>
    </div>
  </div>
</div>


<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

  <div class="lg:col-span-2 bg-white rounded-xl p-6 shadow-sm">
    <div class="mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-1">Distribución por Tipo de Residuo</h3>
      <p class="text-sm text-gray-600">Composición actual de detecciones</p>
    </div>
    <div class="chart-content">
      <div class="composition-chart" *ngIf="estadisticasTipos.length > 0">
        <div class="flex flex-col lg:flex-row items-center gap-8">
          <div class="w-64 h-64">
            <svg viewBox="0 0 120 120" class="w-full h-full">
              <circle cx="60" cy="60" r="40" fill="transparent" stroke="#f0f0f0" stroke-width="8"></circle>
              <circle *ngFor="let tipo of getTopTipos(); let i = index" cx="60" cy="60" r="40" fill="transparent"
                [attr.stroke]="getTipoColor(tipo.tipo)" stroke-width="8"
                [attr.stroke-dasharray]="tipo.porcentaje + ' ' + (100 - tipo.porcentaje)"
                [attr.stroke-dashoffset]="getStrokeDashOffset(i)" class="chart-segment">
              </circle>
              <text x="60" y="55" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">
                {{getTotalDetections()}}
              </text>
              <text x="60" y="70" text-anchor="middle" font-size="10" fill="#666">
                Total
              </text>
            </svg>
          </div>
          <div class="flex-1 space-y-3">
            <div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg" 
                 *ngFor="let tipo of getTopTipos()">
              <div class="flex items-center gap-3">
                <div class="w-4 h-4 rounded-full" [style.background-color]="getTipoColor(tipo.tipo)"></div>
                <span class="text-sm font-medium text-gray-700">{{tipo.tipo}}</span>
              </div>
              <span class="text-sm font-semibold text-gray-800">{{tipo.porcentaje}}%</span>
            </div>
          </div>
        </div>
      </div>
      <div class="flex flex-col items-center justify-center py-12" *ngIf="isLoadingStats">
        <i class="pi pi-spin pi-spinner text-2xl text-gray-400 mb-2"></i>
        <p class="text-gray-600">Cargando datos...</p>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl p-6 shadow-sm">
    <div class="mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-1">Rendimiento de Clasificadores</h3>
      <p class="text-sm text-gray-600 mb-4">{{selectedLocation}}</p>
      <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg" *ngIf="classifierPerformance.length > 0">
        <p class="text-green-700 font-medium">
          Promedio de la zona: <span class="font-bold">{{getAverageDetections()}} detecciones</span>
        </p>
      </div>
    </div>
    <div class="space-y-6">
      <div class="classifier-performance-chart" *ngIf="classifierPerformance.length > 0">
        <div class="space-y-4" *ngFor="let classifier of classifierPerformance; let i = index">
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <span class="font-medium text-gray-700">{{classifier.nombre}}:</span>
            <div class="flex items-center gap-3">
              <span class="text-xl font-bold text-primary-600">
                {{classifier.detecciones}}
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="pt-6 border-t border-gray-200">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        </div>
      </div>

      <div class="flex flex-col items-center justify-center py-8" *ngIf="isLoadingStats">
        <i class="pi pi-spin pi-spinner text-2xl text-gray-400 mb-2"></i>
        <p class="text-gray-600">Cargando datos...</p>
      </div>
    </div>
  </div>

  <div class="lg:col-span-2 bg-white rounded-xl p-6 shadow-sm">
    <div class="mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-1">Actividad por Horas</h3>
      <p class="text-sm text-gray-600">Patrones de detección en {{selectedLocation}}</p>
    </div>
    <div class="chart-content">
      <div class="overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 p-4 min-h-[250px]">
        <div class="grid grid-cols-6 gap-3 min-w-[600px]">
          <div *ngFor="let hour of hourlyActivity; let i = index"
            class="text-center p-4 rounded-lg border-2 transition-all duration-300 hover:shadow-md min-w-[100px]"
            [class]="hour.detections > 0 ? 'bg-blue-50 border-blue-200' : 'bg-gray-50 border-gray-200'">
            <div class="font-bold text-lg mb-2" [class]="hour.detections > 0 ? 'text-blue-600' : 'text-gray-400'">
              {{ hour.hour }}
            </div>
            <div class="text-3xl font-bold" [class]="hour.detections > 0 ? 'text-blue-800' : 'text-gray-500'">
              {{ hour.detections }}
            </div>
          </div>
        </div>
      </div>
      <div class="mt-6 p-4">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div *ngIf="getPeakHour()" class="bg-orange-100 px-4 py-2 rounded-lg">
            <span class="text-orange-600 flex items-center gap-2">
              🔥 Pico: {{ getPeakHour()?.hour }} ({{ getPeakHour()?.detecciones }} detecciones)
            </span>
          </div>
        </div>
      </div>

      <div class="flex flex-col items-center justify-center py-8" *ngIf="isLoadingStats">
        <i class="pi pi-spin pi-spinner text-2xl text-gray-400 mb-2"></i>
        <p class="text-gray-600">Cargando datos...</p>
      </div>
    </div>
  </div>

  <div class="lg:col-span-2 bg-white rounded-xl p-6 shadow-sm">
    <div class="mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-1">Tendencia de Detecciones</h3>
      <p class="text-sm text-gray-600">Evolución en los últimos días</p>
    </div>
    <div class="chart-content">
      <div class="line-chart" *ngIf="estadisticasGenerales">
        <div class="mb-6">
          <svg viewBox="0 0 600 200" class="w-full h-48">
            <defs>
              <pattern id="grid" width="60" height="40" patternUnits="userSpaceOnUse">
                <path d="M 60 0 L 0 0 0 40" fill="none" stroke="#f0f0f0" stroke-width="1" />
              </pattern>
            </defs>
            <rect width="600" height="200" fill="url(#grid)" />

            <polyline [attr.points]="getSimpleTrendPoints()" fill="none" stroke="#4a7c59" stroke-width="3"
              stroke-linecap="round" stroke-linejoin="round">
            </polyline>

            <circle *ngFor="let point of getSimpleDataPoints(); let i = index" [attr.cx]="point.x" [attr.cy]="point.y"
              r="4" fill="#4a7c59" [attr.title]="point.label + ': ' + point.value">
            </circle>

            <polygon [attr.points]="getSimpleTrendAreaPoints()" fill="rgba(74, 124, 89, 0.1)">
            </polygon>
          </svg>
        </div>

        <div class="grid grid-cols-3 gap-4">
          <div class="text-center p-4 bg-gray-50 rounded-lg">
            <span class="block text-sm text-gray-600 mb-1">Promedio</span>
            <span class="text-xl font-bold text-gray-800">{{getAverageDetections()}}</span>
          </div>
          <div class="text-center p-4 bg-gray-50 rounded-lg">
            <span class="block text-sm text-gray-600 mb-1">Máximo</span>
            <span class="text-xl font-bold text-gray-800">{{getMaxDetections()}}</span>
          </div>
          <div class="text-center p-4 bg-gray-50 rounded-lg">
            <span class="block text-sm text-gray-600 mb-1">Tendencia</span>
            <span class="text-xl font-bold" 
                  [class.text-green-600]="getTrendDirection() > 0"
                  [class.text-red-600]="getTrendDirection() < 0"
                  [class.text-gray-600]="getTrendDirection() === 0">
              {{getTrendDirection() > 0 ? '↗' : getTrendDirection() < 0 ? '↘' : '→' }} 
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>