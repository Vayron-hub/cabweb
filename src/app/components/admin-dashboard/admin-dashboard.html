<div class="dashboard-container">
  <!-- Header Verde -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo-container">
          <img src="" alt="Logo" class="logo" />
        </div>
      </div>
      
      <div class="header-center">
        <div class="location-selector-container">
          <i class="pi pi-map-marker location-icon"></i>
          <select [(ngModel)]="selectedLocation" (change)="onLocationChange()" class="location-dropdown">
            <option *ngFor="let location of locations" [value]="location">{{location}}</option>
          </select>
        </div>
      </div>
      
      <div class="header-right">
        <button class="header-btn help-btn">
          <i class="pi pi-question-circle"></i>
        </button>
        <div class="user-menu-container">
          <button 
            class="header-btn user-btn"
            (click)="toggleUserMenu()"
            [class.active]="userMenuOpen">
            <i class="pi pi-user"></i>
          </button>
          
          <!-- Mini menú de usuario -->
          <div class="user-dropdown" *ngIf="userMenuOpen">
            <div class="user-info-header">
              <div class="user-avatar-large">
                <i class="pi pi-user"></i>
              </div>
              <div class="user-details-header">
                <span class="user-name-header">{{currentUser.nombre}}</span>
                <span class="user-role-header">{{currentUser.rol}}</span>
              </div>
            </div>
            
            <div class="menu-divider"></div>
            
            <div class="menu-options">
              <button 
                class="menu-option"
                (click)="viewMyAccount()">
                <i class="pi pi-user-edit"></i>
                <span>Ver mi cuenta</span>
              </button>
              <button 
                class="menu-option logout"
                (click)="logout()">
                <i class="pi pi-sign-out"></i>
                <span>Cerrar sesión</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Barra de Navegación -->
  <div class="nav-bar">
    <button 
      class="nav-item" 
      [class.active]="activeTab === 'dashboard'"
      (click)="setActiveTab('dashboard')">
      <i class="pi pi-chart-bar"></i>
      <span>Dashboard</span>
    </button>
    <button 
      class="nav-item" 
      [class.active]="activeTab === 'estadisticas'"
      (click)="setActiveTab('estadisticas')">
      <i class="pi pi-chart-line"></i>
      <span>Estadísticas</span>
    </button>
    <button 
      class="nav-item" 
      [class.active]="activeTab === 'usuarios'"
      (click)="setActiveTab('usuarios')">
      <i class="pi pi-users"></i>
      <span>Usuarios</span>
    </button>
    <button 
      class="nav-item" 
      [class.active]="activeTab === 'clasificadores'"
      (click)="setActiveTab('clasificadores')">
      <i class="pi pi-filter"></i>
      <span>Clasificadores</span>
    </button>
  </div>

  <!-- Contenido del Dashboard -->
  <div class="dashboard-content" *ngIf="activeTab === 'dashboard'">
    
    <!-- Mensaje de Bienvenida -->
    <div class="welcome-section">
      <div class="welcome-text">
        <h1>¡Buenos días Administrador!</h1>
        <p>Aquí tienes tu dashboard de visualización de tus datos.</p>
      </div>
      <div class="welcome-icon">
        <div class="cam-icon">
          <div class="cam-body"></div>
          <div class="cam-lens"></div>
        </div>
      </div>
    </div>

    <!-- Grid Principal -->
    <div class="main-dashboard-grid">
      
      <!-- Panel Izquierdo - Clasificadores -->
      <div class="classifiers-panel">
        <div class="classifier-item" *ngFor="let classifier of getCurrentClassifiers()">
          <div class="classifier-icon">
            <div class="cam-mini-icon"></div>
          </div>
          <div class="classifier-info">
            <h3>{{classifier.name}}</h3>
            <div class="classifier-counters">
              <span class="counter blue">
                <i class="counter-dot blue"></i>
                {{classifier.activeCount}}
              </span>
              <span class="counter green">
                <i class="counter-dot green"></i>
                {{classifier.inactiveCount}}
              </span>
              <span class="counter gray">
                <i class="counter-dot gray"></i>
                {{classifier.pendingCount}}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel Central - Gráfico de Barras -->
      <div class="chart-panel">
        <div class="bar-chart">
          <div class="bar" [style.height.%]="75"></div>
          <div class="bar" [style.height.%]="45"></div>
          <div class="bar" [style.height.%]="60"></div>
          <div class="bar" [style.height.%]="85"></div>
        </div>
      </div>

      <!-- Panel Derecho - Gráficos Circulares -->
      <div class="pie-charts-panel">
        <div class="pie-chart-row">
          <div class="pie-chart">
            <svg viewBox="0 0 42 42" class="donut">
              <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#e6e6e6" stroke-width="3"></circle>
              <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#4a7c59" stroke-width="3" 
                      stroke-dasharray="60 40" stroke-dashoffset="25"></circle>
            </svg>
          </div>
          <div class="pie-chart">
            <svg viewBox="0 0 42 42" class="donut">
              <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#e6e6e6" stroke-width="3"></circle>
              <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#4a7c59" stroke-width="3" 
                      stroke-dasharray="40 60" stroke-dashoffset="25"></circle>
            </svg>
          </div>
        </div>
        <div class="pie-chart-single">
          <div class="pie-chart">
            <svg viewBox="0 0 42 42" class="donut">
              <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#e6e6e6" stroke-width="3"></circle>
              <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#4a7c59" stroke-width="3" 
                      stroke-dasharray="70 30" stroke-dashoffset="25"></circle>
            </svg>
          </div>
        </div>
      </div>

    </div>

    <!-- Sección Últimas Detecciones -->
    <div class="recent-detections">
      <h2>Últimas detecciones...</h2>
      <div class="detections-content">
        <!-- Contenido de detecciones aquí -->
      </div>
    </div>

  </div>

  <!-- Vista de Estadísticas -->
  <div class="dashboard-content" *ngIf="activeTab === 'estadisticas'">
    
    <!-- Header de Estadísticas -->
    <div class="statistics-header">
      <div class="statistics-title">
        <h2>Estadísticas</h2>
        <p>Análisis general de datos para {{selectedLocation}}</p>
      </div>
      <div class="statistics-actions">
        <button 
          class="btn-primary"
          (click)="exportStatisticsData()">
          <i class="pi pi-download"></i>
          Exportar
        </button>
        <button 
          class="btn-secondary"
          (click)="refreshStatistics()">
          <i class="pi pi-refresh"></i>
          Actualizar
        </button>
      </div>
    </div>

    <!-- Grid de Estadísticas -->
    <div class="statistics-grid">
      
      <!-- Módulo de Detecciones -->
      <div class="stat-module">
        <div class="module-header">
          <h3>Módulo</h3>
          <p>Detecciones por hora</p>
        </div>
        <div class="module-chart">
          <div class="bar-chart-container">
            <div class="chart-bar" [style.height.%]="85">
              <div class="bar-value">85</div>
            </div>
            <div class="chart-bar" [style.height.%]="65">
              <div class="bar-value">65</div>
            </div>
            <div class="chart-bar" [style.height.%]="75">
              <div class="bar-value">75</div>
            </div>
            <div class="chart-bar" [style.height.%]="90">
              <div class="bar-value">90</div>
            </div>
          </div>
          <div class="chart-labels">
            <span>6AM</span>
            <span>12PM</span>
            <span>6PM</span>
            <span>12AM</span>
          </div>
        </div>
      </div>

      <!-- Módulo de Clasificación -->
      <div class="stat-module">
        <div class="module-header">
          <h3>Módulo</h3>
          <p>Clasificaciones exitosas</p>
        </div>
        <div class="module-chart">
          <div class="bar-chart-container">
            <div class="chart-bar" [style.height.%]="92">
              <div class="bar-value">92</div>
            </div>
            <div class="chart-bar" [style.height.%]="78">
              <div class="bar-value">78</div>
            </div>
            <div class="chart-bar" [style.height.%]="88">
              <div class="bar-value">88</div>
            </div>
            <div class="chart-bar" [style.height.%]="95">
              <div class="bar-value">95</div>
            </div>
          </div>
          <div class="chart-labels">
            <span>Lun</span>
            <span>Mar</span>
            <span>Mié</span>
            <span>Jue</span>
          </div>
        </div>
      </div>

      <!-- Módulo de Transporte -->
      <div class="stat-module">
        <div class="module-header">
          <h3>Módulo</h3>
          <p>Flujo de transporte</p>
        </div>
        <div class="module-chart">
          <div class="bar-chart-container">
            <div class="chart-bar" [style.height.%]="70">
              <div class="bar-value">70</div>
            </div>
            <div class="chart-bar" [style.height.%]="45">
              <div class="bar-value">45</div>
            </div>
            <div class="chart-bar" [style.height.%]="60">
              <div class="bar-value">60</div>
            </div>
            <div class="chart-bar" [style.height.%]="80">
              <div class="bar-value">80</div>
            </div>
          </div>
          <div class="chart-labels">
            <span>Bus</span>
            <span>Auto</span>
            <span>Moto</span>
            <span>Bike</span>
          </div>
        </div>
      </div>

      <!-- Módulo de Usuarios -->
      <div class="stat-module">
        <div class="module-header">
          <h3>Módulo</h3>
          <p>Actividad de usuarios</p>
        </div>
        <div class="module-chart">
          <div class="bar-chart-container">
            <div class="chart-bar" [style.height.%]="88">
              <div class="bar-value">88</div>
            </div>
            <div class="chart-bar" [style.height.%]="72">
              <div class="bar-value">72</div>
            </div>
            <div class="chart-bar" [style.height.%]="95">
              <div class="bar-value">95</div>
            </div>
            <div class="chart-bar" [style.height.%]="63">
              <div class="bar-value">63</div>
            </div>
          </div>
          <div class="chart-labels">
            <span>Admin</span>
            <span>Op</span>
            <span>View</span>
            <span>Guest</span>
          </div>
        </div>
      </div>

    </div>

  </div>

  <div class="dashboard-content" *ngIf="activeTab === 'usuarios'">
    
    <!-- Header de Usuarios -->
    <div class="users-header">
      <div class="users-title">
        <h2>Gestión de Usuarios</h2>
        <p>Administrar usuarios del sistema para {{selectedLocation}}</p>
      </div>
      <div class="users-actions">
        <button 
          class="btn-primary"
          (click)="exportUsersData()">
          <i class="pi pi-download"></i>
          Exportar
        </button>
        <button 
          class="btn-success"
          (click)="addNewUser()">
          <i class="pi pi-plus"></i>
          Nuevo Usuario
        </button>
      </div>
    </div>

    <!-- Filtros de búsqueda -->
    <div class="search-filters">
      <div class="search-bar">
        <div class="search-input-container">
          <i class="pi pi-search search-icon"></i>
          <input 
            type="text" 
            placeholder="Buscar usuarios por nombre o correo..."
            [(ngModel)]="searchTerm"
            (input)="filterUsers()"
            class="search-input">
        </div>
      </div>
      <div class="role-filters">
        <label class="filter-label">Filtrar por rol:</label>
        <div class="role-checkboxes">
          <label class="checkbox-item" *ngFor="let role of roleOptions">
            <input 
              type="checkbox" 
              [value]="role.value"
              (change)="onRoleFilterChange($event)"
              [checked]="selectedRoles.includes(role.value)">
            <span class="checkmark"></span>
            {{role.label}}
          </label>
        </div>
      </div>
    </div>

    <!-- Estadísticas de usuarios -->
    <div class="users-stats">
      <div class="stat-card">
        <div class="stat-icon active">
          <i class="pi pi-users"></i>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{getActiveUsersCount()}}</span>
          <span class="stat-label">Usuarios Activos</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon inactive">
          <i class="pi pi-user-minus"></i>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{getInactiveUsersCount()}}</span>
          <span class="stat-label">Usuarios Inactivos</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon total">
          <i class="pi pi-chart-bar"></i>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{getTotalUsersCount()}}</span>
          <span class="stat-label">Total Usuarios</span>
        </div>
      </div>
    </div>

    <!-- Tabla de usuarios -->
    <div class="users-table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>
              <input 
                type="checkbox" 
                (change)="selectAllUsers($event)"
                [checked]="allUsersSelected()">
            </th>
            <th>Usuario</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Estado</th>
            <th>Último Acceso</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers; trackBy: trackByUserId" 
              [class.selected]="selectedUsers.includes(user.id)">
            <td>
              <input 
                type="checkbox" 
                [value]="user.id"
                (change)="toggleUserSelection(user.id, $event)"
                [checked]="selectedUsers.includes(user.id)">
            </td>
            <td>
              <div class="user-info">
                <div class="user-avatar">
                  <i class="pi pi-user"></i>
                </div>
                <div class="user-details">
                  <span class="user-name">{{user.nombre}}</span>
                  <span class="user-id">ID: {{user.id}}</span>
                </div>
              </div>
            </td>
            <td class="user-email">{{user.email}}</td>
            <td>
              <span class="role-badge" [ngClass]="getRoleClass(user.rol)">
                {{user.rol}}
              </span>
            </td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(user.estado)">
                <i class="pi" [ngClass]="getStatusIcon(user.estado)"></i>
                {{user.estado}}
              </span>
            </td>
            <td class="last-access">{{formatDate(user.ultimoAcceso)}}</td>
            <td class="actions">
              <button 
                class="action-btn edit"
                (click)="editUser(user)"
                [disabled]="!canEditUser()"
                title="Editar usuario">
                <i class="pi pi-pencil"></i>
              </button>
              <button 
                class="action-btn delete"
                (click)="deleteUser(user)"
                [disabled]="!canDeleteUser(user)"
                title="Eliminar usuario">
                <i class="pi pi-trash"></i>
              </button>
              <button 
                class="action-btn toggle"
                (click)="toggleUserStatus(user)"
                [disabled]="!canEditUser()"
                [title]="user.estado === 'Activo' ? 'Desactivar usuario' : 'Activar usuario'">
                <i class="pi" [ngClass]="user.estado === 'Activo' ? 'pi-eye-slash' : 'pi-eye'"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      
      <!-- Mensaje cuando no hay usuarios -->
      <div class="no-users" *ngIf="filteredUsers.length === 0">
        <i class="pi pi-users"></i>
        <h3>No se encontraron usuarios</h3>
        <p>No hay usuarios que coincidan con los filtros aplicados.</p>
      </div>
    </div>

    <!-- Acciones masivas -->
    <div class="bulk-actions" *ngIf="selectedUsers.length > 0">
      <div class="selected-count">
        {{selectedUsers.length}} usuario(s) seleccionado(s)
      </div>
      <div class="bulk-buttons">
        <button 
          class="btn-warning"
          (click)="bulkDeactivateUsers()"
          [disabled]="!canEditUser()">
          <i class="pi pi-eye-slash"></i>
          Desactivar
        </button>
        <button 
          class="btn-success"
          (click)="bulkActivateUsers()"
          [disabled]="!canEditUser()">
          <i class="pi pi-eye"></i>
          Activar
        </button>
        <button 
          class="btn-danger"
          (click)="bulkDeleteUsers()"
          [disabled]="!canEditUser()">
          <i class="pi pi-trash"></i>
          Eliminar
        </button>
      </div>
    </div>

  </div>

  <div class="dashboard-content" *ngIf="activeTab === 'clasificadores'">
    
    <!-- Sección de filtro de búsqueda -->
    <div class="classifiers-search-section">
      <h2>Filtro de búsqueda</h2>
      <div class="search-input-wrapper">
        <input 
          type="text" 
          placeholder="Buscar clasificadores por nombre..."
          [(ngModel)]="classifierSearchTerm"
          (input)="filterClassifiers()"
          class="classifier-search-input">
        <button class="search-button">
          <i class="pi pi-search"></i>
        </button>
      </div>
    </div>

    <!-- Lista de clasificadores simple -->
    <div class="classifiers-simple-section">
      <div class="classifiers-header-simple">
        <h2>Clasificadores 10 | 15</h2>
        <button class="add-classifier-btn">
          <i class="pi pi-plus"></i>
        </button>
      </div>
      
      <div class="classifiers-simple-list">
        <div class="classifier-simple-item" *ngFor="let classifier of getCurrentClassifiers()">
          <div class="classifier-device-icon">
            <div class="device-screen"></div>
          </div>
          <div class="classifier-simple-info">
            <h3>{{classifier.name}}</h3>
            <div class="classifier-simple-counters">
              <span class="simple-counter blue">
                <i class="pi pi-user"></i>
                {{classifier.activeCount}}
              </span>
              <span class="simple-counter green">
                <i class="pi pi-user"></i>
                {{classifier.inactiveCount}}
              </span>
              <span class="simple-counter gray">
                <i class="pi pi-user"></i>
                {{classifier.pendingCount}}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Modal de Mi Cuenta -->
  <div class="modal-overlay" *ngIf="showAccountModal" (click)="closeAccountModal()">
    <div class="account-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Mi Cuenta</h2>
        <button class="close-btn" (click)="closeAccountModal()">
          <i class="pi pi-times"></i>
        </button>
      </div>
      
      <div class="modal-content">
        <div class="account-info-section">
          <div class="account-avatar">
            <i class="pi pi-user"></i>
          </div>
          
          <div class="account-details">
            <div class="info-group">
              <label>Nombre Completo</label>
              <span>{{currentUser.nombre}}</span>
            </div>
            
            <div class="info-group">
              <label>Rol</label>
              <span class="role-tag">{{currentUser.rol}}</span>
            </div>
            
            <div class="info-group">
              <label>Email</label>
              <span>{{currentUser.email}}</span>
            </div>
            
            <div class="info-group">
              <label>ID de Usuario</label>
              <span>{{currentUser.id}}</span>
            </div>
            
            <div class="info-group">
              <label>Último Acceso</label>
              <span>{{formatAccountDate(currentUser.ultimoAcceso)}}</span>
            </div>
            
            <div class="info-group">
              <label>Estado de Cuenta</label>
              <span class="status-active">
                <i class="pi pi-check-circle"></i>
                Activa
              </span>
            </div>
          </div>
        </div>
        
        <div class="account-actions">
          <button class="btn-secondary" (click)="editProfile()">
            <i class="pi pi-pencil"></i>
            Editar Perfil
          </button>
          <button class="btn-warning" (click)="changePassword()">
            <i class="pi pi-key"></i>
            Cambiar Contraseña
          </button>
        </div>
      </div>
    </div>
  </div>

</div>
