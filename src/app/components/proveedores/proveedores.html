<div class="max-w-7xl mx-auto p-5 space-y-8">
  <!-- Header -->
  <div class="bg-white rounded-2xl shadow-sm p-8 border-l-4 border-emerald-600">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">
      Gestión de Proveedores
    </h1>
    <p class="text-gray-500 text-sm">
      Administre los proveedores del sistema CAB
    </p>
  </div>

  <!-- Card principal -->
  <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
    <!-- Top bar -->
    <div
      class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 p-6 border-b border-gray-200"
    >
      <div class="flex items-center gap-3">
        <div
          class="w-12 h-12 rounded-xl bg-emerald-100 text-emerald-600 flex items-center justify-center text-2xl"
        >
          <i class="pi pi-truck"></i>
        </div>
        <div>
          <h2 class="text-xl font-semibold text-gray-800">Proveedores</h2>
          <p class="text-xs text-gray-500">
            {{filteredProveedores.length}} resultado(s)
          </p>
        </div>
      </div>
      <div class="flex flex-wrap gap-3">
        <button
          (click)="openAddSupplierModal()"
          class="inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-medium px-5 py-2.5 rounded-xl text-sm shadow"
        >
          <i class="pi pi-plus"></i> Nuevo
        </button>
        <!-- <button
          (click)="exportSuppliersData()"
          class="inline-flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium px-5 py-2.5 rounded-xl text-sm"
        >
          <i class="pi pi-download"></i> Exportar
        </button> -->
        <button
          (click)="loadProveedores()"
          [disabled]="isLoadingProveedores"
          class="inline-flex items-center gap-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium px-5 py-2.5 rounded-xl text-sm disabled:opacity-50"
        >
          <i
            class="pi"
            [ngClass]="isLoadingProveedores ? 'pi-spin pi-spinner' : 'pi-refresh'"
          ></i>
          {{isLoadingProveedores ? 'Actualizando...' : 'Actualizar'}}
        </button>
      </div>
    </div>

    <!-- Filtros -->
    <div class="p-6 bg-gray-50 border-b border-gray-200">
      <div class="grid gap-5 md:grid-cols-3">
        <div class="flex flex-col gap-2">
          <label
            class="text-xs font-semibold uppercase tracking-wide text-gray-500"
            >Buscar</label
          >
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="applyFilters()"
            placeholder="Nombre, producto o contacto..."
            class="px-4 py-2.5 rounded-xl border-2 border-gray-200 focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 text-sm"
          />
        </div>
        <div class="flex flex-col gap-2">
          <label
            class="text-xs font-semibold uppercase tracking-wide text-gray-500"
            >Estado</label
          >
          <select
            [(ngModel)]="selectedStatusFilter"
            (change)="applyFilters()"
            class="px-4 py-2.5 rounded-xl border-2 border-gray-200 focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 text-sm"
          >
            <option value="all">Todos</option>
            <option value="active">Activos</option>
            <option value="inactive">Inactivos</option>
          </select>
        </div>
        <div class="flex items-end">
          <button
            (click)="clearFilters()"
            class="w-full inline-flex items-center justify-center gap-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium px-5 py-2.5 rounded-xl text-sm"
          >
            <i class="pi pi-filter-slash"></i> Limpiar filtros
          </button>
        </div>
      </div>
    </div>

    <!-- Acciones masivas -->
    <div
      *ngIf="selectedProveedores.length > 0"
      class="flex flex-wrap items-center gap-4 px-6 py-4 bg-emerald-50 border-b border-emerald-100"
    >
      <div class="text-sm text-emerald-800 font-medium">
        {{selectedProveedores.length}} seleccionado(s)
      </div>
      <div class="flex flex-wrap gap-2">
        <button
          (click)="bulkActivateSuppliers()"
          class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-semibold rounded-lg shadow"
        >
          Activar
        </button>
        <button
          (click)="bulkDeactivateSuppliers()"
          class="px-4 py-2 bg-neutral-500 hover:bg-neutral-600 text-white text-xs font-semibold rounded-lg"
        >
          Desactivar
        </button>
        <button
          (click)="bulkDeleteSuppliers()"
          class="px-4 py-2 bg-danger-600 hover:bg-danger-700 text-white text-xs font-semibold rounded-lg"
        >
          Eliminar
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div
      *ngIf="isLoadingProveedores"
      class="flex flex-col items-center justify-center py-24 gap-4"
    >
      <i class="pi pi-spin pi-spinner text-3xl text-emerald-500"></i>
      <p class="text-sm text-gray-500">Cargando proveedores...</p>
    </div>

    <!-- Tabla -->
    <div
      *ngIf="!isLoadingProveedores && filteredProveedores.length > 0"
      class="overflow-x-auto"
    >
      <table class="min-w-full text-sm">
        <thead>
          <tr class="bg-gray-50 text-gray-600">
            <th class="px-6 py-4 text-left w-10">
              <input
                type="checkbox"
                (change)="selectAllSuppliers($event)"
                [checked]="allProductsSelected()"
                class="w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"
              />
            </th>
            <th class="px-6 py-4 text-left">Proveedor</th>
            <th class="px-6 py-4 text-left">Contacto</th>
            <th class="px-6 py-4 text-center">Activo</th>
            <th class="px-6 py-4 text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let p of getPaginatedProveedores(); trackBy: trackByProveedorId"
            class="border-b border-gray-100 hover:bg-gray-50 transition-colors"
          >
            <td class="px-6 py-3 align-top">
              <input
                type="checkbox"
                (change)="toggleSupplierSelection(p.id, $event)"
                [checked]="selectedProveedores.includes(p.id)"
                class="w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"
              />
            </td>
            <td class="px-6 py-3 align-top">
              <div class="flex items-start gap-3">
                <div
                  class="w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center"
                >
                  <i class="pi pi-truck"></i>
                </div>
                <div>
                  <h3 class="font-semibold text-gray-800 leading-tight">
                    {{p.nombre}}
                  </h3>
                </div>
              </div>
            </td>
            <td class="px-6 py-3 align-top">
              <ul class="space-y-1 text-gray-600 text-xs">
                <li *ngFor="let c of p.contacto">{{c}}</li>
              </ul>
            </td>
            <td class="px-6 py-3 align-top text-center">
              <span
                [ngClass]="p.activo ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'"
                class="px-3 py-1 rounded-full text-[10px] font-semibold tracking-wide uppercase"
                >{{getStatusText(p.activo)}}</span
              >
            </td>
            <td class="px-6 py-3 align-top">
              <div class="flex justify-end gap-2">
                <button
                  (click)="openEditSupplierModal(p)"
                  title="Editar"
                  class="p-2 rounded-lg bg-primary-100 hover:bg-primary-200 text-primary-600 text-xs"
                >
                  <i class="pi pi-pencil"></i>
                </button>
                <button
                  (click)="toggleSupplierStatus(p)"
                  title="{{p.activo ? 'Desactivar' : 'Activar'}}"
                  class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-600 text-xs"
                >
                  <i
                    class="pi"
                    [ngClass]="p.activo ? 'pi-ban' : 'pi-check'"
                  ></i>
                </button>
                <button
                  (click)="deleteSupplier(p)"
                  title="Eliminar"
                  class="p-2 rounded-lg bg-red-100 hover:bg-red-200 text-red-600 text-xs"
                >
                  <i class="pi pi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty state -->
    <div
      *ngIf="!isLoadingProveedores && filteredProveedores.length === 0"
      class="py-24 flex flex-col items-center justify-center text-center gap-4"
    >
      <div
        class="w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center text-4xl text-gray-400"
      >
        <i class="pi pi-truck"></i>
      </div>
      <h3 class="text-lg font-semibold text-gray-700">
        No se encontraron proveedores
      </h3>
      <p class="text-sm text-gray-500 max-w-md">
        Prueba ajustando los filtros o agrega un nuevo proveedor al sistema.
      </p>
      <button
        (click)="openAddSupplierModal()"
        class="inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-medium px-5 py-2.5 rounded-xl text-sm shadow"
      >
        <i class="pi pi-plus"></i> Agregar primero
      </button>
    </div>

    <!-- Paginación -->
    <div
      *ngIf="!isLoadingProveedores && filteredProveedores.length > 0"
      class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 p-6 border-t border-gray-200"
    >
      <div class="text-xs text-gray-500">
        Página {{currentPage}} de {{totalPages}}
      </div>
      <div class="flex items-center gap-2">
        <button
          (click)="goToPage(currentPage-1)"
          [disabled]="currentPage===1"
          class="px-3 py-2 rounded-lg border text-xs font-medium disabled:opacity-40 disabled:cursor-not-allowed bg-white hover:bg-gray-50 border-gray-300"
        >
          Anterior
        </button>
        <ng-container
          *ngFor="let page of [].constructor(totalPages); let i = index"
        >
          <button
            (click)="goToPage(i+1)"
            [ngClass]="i+1===currentPage ? 'bg-emerald-600 text-white border-emerald-600' : 'bg-white hover:bg-gray-50 border-gray-300 text-gray-700'"
            class="px-3 py-2 rounded-lg border text-xs font-medium"
          >
            {{i+1}}
          </button>
        </ng-container>
        <button
          (click)="goToPage(currentPage+1)"
          [disabled]="currentPage===totalPages"
          class="px-3 py-2 rounded-lg border text-xs font-medium disabled:opacity-40 disabled:cursor-not-allowed bg-white hover:bg-gray-50 border-gray-300"
        >
          Siguiente
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  *ngIf="showSupplierModal"
  class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4"
  (click)="closeSupplierModal()"
>
  <div
    class="bg-white rounded-2xl shadow-xl w-full max-w-xl max-h-[90vh] overflow-y-auto animate-slide-up"
    (click)="$event.stopPropagation()"
  >
    <div class="flex items-center justify-between p-6 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-800">
        {{editingSupplier ? 'Editar Proveedor' : 'Nuevo Proveedor'}}
      </h3>
      <button
        (click)="closeSupplierModal()"
        class="w-9 h-9 rounded-lg flex items-center justify-center hover:bg-gray-100 text-gray-500"
      >
        <i class="pi pi-times"></i>
      </button>
    </div>
    <form
      class="p-6 space-y-6"
      (ngSubmit)="saveSupplier()"
      #supplierForm="ngForm"
    >
      <div class="grid md:grid-cols-2 gap-5">
        <div class="flex flex-col gap-2 md:col-span-2">
          <label
            class="text-xs font-semibold uppercase tracking-wide text-gray-500"
            >Nombre *</label
          >
          <input
            type="text"
            [(ngModel)]="supplierFormData.nombre"
            name="nombre"
            required
            class="px-4 py-2.5 rounded-xl border-2 border-gray-200 focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 text-sm"
          />
        </div>
        <div class="flex flex-col gap-2 md:col-span-2">
          <label
            class="text-xs font-semibold uppercase tracking-wide text-gray-500"
            >Contacto (una línea por dato)</label
          >
          <textarea
            [(ngModel)]="contactoInput"
            name="contacto"
            rows="4"
            class="px-4 py-2.5 rounded-xl border-2 border-gray-200 focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 text-sm resize-y"
          ></textarea>
        </div>
        <div class="flex items-center gap-3 md:col-span-2" *ngIf="editingSupplier">
          <input
            type="checkbox"
            [(ngModel)]="supplierFormData.activo"
            name="activo"
            class="w-5 h-5 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"
          />
          <span class="text-sm text-gray-700">Activo</span>
        </div>
      </div>
      <div class="flex justify-end gap-3 pt-2">
        <button
          type="button"
          (click)="closeSupplierModal()"
          class="px-5 py-2.5 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 text-sm font-medium"
        >
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="supplierForm.invalid"
          class="px-5 py-2.5 rounded-xl bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 text-white text-sm font-medium inline-flex items-center gap-2"
        >
          <i class="pi pi-save"></i> {{editingSupplier ? 'Actualizar' :
          'Guardar'}}
        </button>
      </div>
    </form>
  </div>
</div>
