<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti√≥n de Proveedores</title>
    <style>
      /* Copia el estilo de productos y ajusta colores e √≠conos para proveedores */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
      }
      .header {
        background: white;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
        border-left: 5px solid #059669;
      }
      .header h1 {
        color: #1f2937;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
      }
      .header p {
        color: #6b7280;
        font-size: 1.1rem;
      }
      .suppliers-section {
        background: white;
        border-radius: 16px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        overflow: hidden;
      }
      .section-header {
        padding: 30px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
      }
      .section-title {
        color: #1f2937;
        font-size: 1.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .controls-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
      }
      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn-primary {
        background: linear-gradient(135deg, #059669, #10b981);
        color: white;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(5, 150, 105, 0.4);
      }
      .btn-secondary {
        background: #f3f4f6;
        color: #374151;
        border: 2px solid #e5e7eb;
      }
      .btn-secondary:hover {
        background: #e5e7eb;
        border-color: #d1d5db;
      }
      .btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
      }
      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .filters-section {
        padding: 30px;
        border-bottom: 1px solid #e5e7eb;
        background: #f9fafb;
      }
      .filters-grid {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 20px;
        align-items: end;
      }
      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .filter-label {
        font-weight: 600;
        color: #374151;
        font-size: 0.95rem;
      }
      .filter-input {
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }
      .filter-input:focus {
        outline: none;
        border-color: #059669;
        box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
      }
      .bulk-actions {
        padding: 20px 30px;
        background: #f8fafc;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        gap: 15px;
        align-items: center;
      }
      .bulk-actions-text {
        color: #6b7280;
        font-weight: 500;
      }
      .table-container {
        overflow-x: auto;
      }
      .suppliers-table {
        width: 100%;
        border-collapse: collapse;
      }
      .suppliers-table th {
        background: #f9fafb;
        padding: 20px;
        text-align: left;
        font-weight: 600;
        color: #374151;
        border-bottom: 2px solid #e5e7eb;
        white-space: nowrap;
      }
      .suppliers-table td {
        padding: 20px;
        border-bottom: 1px solid #f3f4f6;
        vertical-align: middle;
      }
      .suppliers-table tr:hover {
        background: #f9fafb;
      }
      .supplier-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .supplier-icon {
        font-size: 2rem;
        color: #059669;
      }
      .supplier-details h4 {
        color: #1f2937;
        font-weight: 600;
        margin-bottom: 4px;
      }
      .supplier-details p {
        color: #6b7280;
        font-size: 0.9rem;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .contact-info {
        color: #374151;
        font-size: 0.95rem;
      }
      .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .status-badge.active {
        background: #d1fae5;
        color: #065f46;
      }
      .status-badge.inactive {
        background: #fecaca;
        color: #991b1b;
      }
      .actions-group {
        display: flex;
        gap: 8px;
      }
      .btn-small {
        padding: 8px 12px;
        font-size: 0.85rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .btn-edit {
        background: #dbeafe;
        color: #1d4ed8;
      }
      .btn-edit:hover {
        background: #bfdbfe;
      }
      .btn-delete {
        background: #fecaca;
        color: #dc2626;
      }
      .btn-delete:hover {
        background: #fca5a5;
      }
      .btn-toggle {
        background: #f3f4f6;
        color: #374151;
      }
      .btn-toggle:hover {
        background: #e5e7eb;
      }
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        padding: 30px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1f2937;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6b7280;
        padding: 4px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }
      .modal-close:hover {
        background: #f3f4f6;
        color: #374151;
      }
      .modal-body {
        padding: 30px;
      }
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .form-group.full-width {
        grid-column: 1 / -1;
      }
      .form-label {
        font-weight: 600;
        color: #374151;
        font-size: 0.95rem;
      }
      .form-input {
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }
      .form-input:focus {
        outline: none;
        border-color: #059669;
        box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
      }
      .form-textarea {
        resize: vertical;
        min-height: 100px;
      }
      .form-checkbox {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 0;
      }
      .checkbox-input {
        width: 20px;
        height: 20px;
        accent-color: #059669;
      }
      .modal-footer {
        padding: 30px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        gap: 15px;
        justify-content: flex-end;
      }
      .pagination-section {
        padding: 30px;
        border-top: 1px solid #e5e7eb;
        background: #f9fafb;
      }
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
      }
      .pagination-btn {
        padding: 10px 16px;
        border: 2px solid #e5e7eb;
        background: white;
        color: #374151;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }
      .pagination-btn:hover:not(.active) {
        border-color: #059669;
        color: #059669;
      }
      .pagination-btn.active {
        background: #059669;
        color: white;
        border-color: #059669;
      }
      .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .pagination-info {
        margin: 0 20px;
        color: #6b7280;
        font-weight: 500;
      }
      .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px 20px;
      }
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f4f6;
        border-left: 4px solid #059669;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg);}
        100% { transform: rotate(360deg);}
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
      }
      .empty-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
      }
      .empty-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 10px;
      }
      .empty-text {
        color: #6b7280;
        font-size: 1.1rem;
      }
      @media (max-width: 768px) {
        .container { padding: 10px;}
        .header { padding: 20px;}
        .header h1 { font-size: 2rem;}
        .section-header { padding: 20px; flex-direction: column; align-items: stretch;}
        .controls-group { justify-content: stretch;}
        .filters-grid { grid-template-columns: 1fr; gap: 15px;}
        .form-grid { grid-template-columns: 1fr;}
        .suppliers-table th, .suppliers-table td { padding: 15px 10px; font-size: 0.9rem;}
        .supplier-details p { max-width: 200px;}
        .modal { width: 95%; margin: 20px;}
        .modal-header, .modal-body, .modal-footer { padding: 20px;}
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>Gesti√≥n de Proveedores</h1>
        <p>Administre los proveedores del sistema CAB</p>
      </div>
      <!-- Suppliers Section -->
      <div class="suppliers-section">
        <!-- Section Header -->
        <div class="section-header">
          <h2 class="section-title">Proveedores</h2>
          <div class="controls-group">
            <button class="btn btn-primary" (click)="openAddSupplierModal()">
              Agregar Proveedor
            </button>
          </div>
        </div>
        <!-- Filters Section -->
        <div class="filters-section">
          <div class="filters-grid">
            <div class="filter-group">
              <label class="filter-label">Buscar proveedores</label>
              <input
                type="text"
                class="filter-input"
                placeholder="Buscar por nombre o correo..."
                [(ngModel)]="searchTerm"
                (input)="applyFilters()"
              />
            </div>
            <div class="filter-group">
              <label class="filter-label">Estado</label>
              <select
                class="filter-input"
                [(ngModel)]="selectedStatusFilter"
                (change)="applyFilters()"
              >
                <option value="all">Todos los estados</option>
                <option value="active">Activos</option>
                <option value="inactive">Inactivos</option>
              </select>
            </div>
            <div class="filter-group">
              <button class="btn btn-secondary" (click)="clearFilters()">
                üîÑ Limpiar
              </button>
            </div>
          </div>
        </div>
        <!-- Bulk Actions -->
        <div class="bulk-actions" *ngIf="selectedProveedores.length > 0">
          <span class="bulk-actions-text">
            {{ selectedProveedores.length }} proveedor(es) seleccionado(s)
          </span>
          <button class="btn btn-secondary" (click)="bulkActivateSuppliers()">
            ‚úÖ Activar
          </button>
          <button class="btn btn-secondary" (click)="bulkDeactivateSuppliers()">
            ‚ùå Desactivar
          </button>
          <button class="btn btn-danger" (click)="bulkDeleteSuppliers()">
            üóëÔ∏è Eliminar
          </button>
        </div>
        <!-- Loading State -->
        <div class="loading-container" *ngIf="isLoadingProveedores">
          <div class="loading-spinner"></div>
        </div>
        <!-- Suppliers Table -->
        <div class="table-container" *ngIf="!isLoadingProveedores && filteredProveedores.length > 0">
          <table class="suppliers-table">
            <thead>
              <tr>
                <th>
                  <input
                    type="checkbox"
                    [checked]="allProductsSelected()"
                    (change)="selectAllSuppliers($event)"
                  />
                </th>
                <th>Proveedor</th>
                <th>Correo</th>
                <th>Productos</th>
                <th>Estado</th>
                <th>Fecha Registro</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let proveedor of getPaginatedProveedores()">
                <td>
                  <input
                    type="checkbox"
                    [checked]="selectedProveedores.includes(proveedor.id)"
                    (change)="toggleSupplierSelection(proveedor.id, $event)"
                  />
                </td>
                <td>
                  <div class="supplier-info">
                    <div class="supplier-icon">üè¢</div>
                    <div class="supplier-details">
                      <h4>{{ proveedor.nombre }}</h4>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="contact-info">
                    ‚úâÔ∏è {{ proveedor.email }}
                  </div>
                </td>
                <td>
                  {{ proveedor.productos }}
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(proveedor.activo)">
                    {{ getStatusText(proveedor.activo) }}
                  </span>
                </td>
                <td>{{ formatDate(proveedor.fechaRegistro) }}</td>
                <td>
                  <div class="actions-group">
                    <button class="btn-small btn-edit" (click)="openEditSupplierModal(proveedor)">
                      ‚úèÔ∏è Editar
                    </button>
                    <button class="btn-small btn-toggle" (click)="toggleSupplierStatus(proveedor)">
                      {{ proveedor.activo ? "‚ùå" : "‚úÖ" }}
                    </button>
                    <button class="btn-small btn-delete" (click)="deleteSupplier(proveedor)">
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Empty State -->
        <div class="empty-state" *ngIf="!isLoadingProveedores && filteredProveedores.length === 0">
          <div class="empty-icon">üè¢</div>
          <h3 class="empty-title">No hay proveedores</h3>
          <p class="empty-text">
            Comience agregando su primer proveedor al sistema
          </p>
          <button class="btn btn-primary" (click)="openAddSupplierModal()" style="margin-top: 20px">
            ‚ûï Agregar Primer Proveedor
          </button>
        </div>
        <!-- Pagination -->
        <div class="pagination-section" *ngIf="filteredProveedores.length > 0">
          <div class="pagination">
            <button
              class="pagination-btn"
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)"
            >
              ‚¨ÖÔ∏è Anterior
            </button>
            <span class="pagination-info">
              P√°gina {{ currentPage }} de {{ totalPages }}
            </span>
            <button
              class="pagination-btn"
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)"
            >
              Siguiente ‚û°Ô∏è
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Supplier Modal -->
    <div class="modal-overlay" *ngIf="showSupplierModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">
            {{ editingSupplier ? "Editar Proveedor" : "Agregar Proveedor" }}
          </h3>
          <button class="modal-close" (click)="closeSupplierModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <form #supplierForm="ngForm">
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label">Nombre *</label>
                <input
                  type="text"
                  class="form-input"
                  name="nombre"
                  [(ngModel)]="supplierFormData.nombre"
                  required
                  placeholder="Ej: Electr√≥nica Mexicana S.A."
                />
              </div>
              <div class="form-group">
                <label class="form-label">Correo *</label>
                <input
                  type="email"
                  class="form-input"
                  name="email"
                  [(ngModel)]="supplierFormData.email"
                  required
                  placeholder="contacto@empresa.com"
                />
              </div>
              <div class="form-group full-width">
                <label class="form-label">Productos que provee</label>
                <textarea
                  class="form-input form-textarea"
                  name="productos"
                  [(ngModel)]="supplierFormData.productos"
                  placeholder="Lista de productos principales..."
                ></textarea>
              </div>
              <div class="form-group full-width">
                <div class="form-checkbox">
                  <input
                    type="checkbox"
                    class="checkbox-input"
                    name="activo"
                    [(ngModel)]="supplierFormData.activo"
                  />
                  <label for="activo" class="form-label">Proveedor activo</label>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeSupplierModal()">
            Cancelar
          </button>
          <button
            class="btn btn-primary"
            (click)="saveSupplier()"
            [disabled]="!supplierForm.valid"
          >
            {{ editingSupplier ? "Actualizar Proveedor" : "Guardar Proveedor" }}
          </button>
        </div>
      </div>
    </div>
    <script>
      // Variables globales
      let proveedores = [];
      let filteredProveedores = [];
      let selectedProveedores = [];
      let isLoadingProveedores = false;
      let supplierCurrentPage = 1;
      let supplierItemsPerPage = 10;
      let supplierTotalPages = 0;
      let editingSupplier = null;

      document.addEventListener("DOMContentLoaded", function () {
        loadProveedores();
      });

      function loadProveedores() {
        isLoadingProveedores = true;
        showSupplierLoading();
        setTimeout(() => {
          proveedores = [
            {
              id: 1,
              nombre: "Electr√≥nica Mexicana S.A.",
              email: "ventas@emex.com.mx",
              productos: "Microcontroladores, sensores, cables",
              activo: true,
              fechaRegistro: new Date("2025-01-10"),
            },
            {
              id: 2,
              nombre: "Distribuidora Rob√≥tica",
              email: "contacto@robotica.mx",
              productos: "Motores, placas Arduino, servos",
              activo: true,
              fechaRegistro: new Date("2025-01-12"),
            },
            {
              id: 3,
              nombre: "Proveedor Inactivo",
              email: "info@inactivo.com",
              productos: "Componentes varios",
              activo: false,
              fechaRegistro: new Date("2025-01-15"),
            },
          ];
          isLoadingProveedores = false;
          applySupplierFilters();
          hideSupplierLoading();
        }, 1000);
      }

      function applySupplierFilters() {
        let filtered = [...proveedores];
        const searchTerm = document
          .getElementById("supplierSearchInput")
          .value.toLowerCase()
          .trim();
        if (searchTerm) {
          filtered = filtered.filter(
            (proveedor) =>
              proveedor.nombre.toLowerCase().includes(searchTerm) ||
              proveedor.email.toLowerCase().includes(searchTerm)
          );
        }
        const statusFilter = document.getElementById("supplierStatusFilter").value;
        if (statusFilter !== "all") {
          filtered = filtered.filter((proveedor) =>
            statusFilter === "active" ? proveedor.activo : !proveedor.activo
          );
        }
        filteredProveedores = filtered;
        updateSupplierPagination();
        renderProveedores();
      }

      function updateSupplierPagination() {
        supplierTotalPages = Math.ceil(filteredProveedores.length / supplierItemsPerPage);
        if (supplierCurrentPage > supplierTotalPages) {
          supplierCurrentPage = 1;
        }
        document.getElementById("supplierPrevBtn").disabled = supplierCurrentPage <= 1;
        document.getElementById("supplierNextBtn").disabled = supplierCurrentPage >= supplierTotalPages;
        document.getElementById("supplierPaginationInfo").textContent = `P√°gina ${supplierCurrentPage} de ${supplierTotalPages}`;
      }

      function renderProveedores() {
        const tableBody = document.getElementById("suppliersTableBody");
        const suppliersTable = document.getElementById("suppliersTable");
        const emptyState = document.getElementById("emptySupplierState");
        const paginationSection = document.getElementById("supplierPaginationSection");
        if (filteredProveedores.length === 0) {
          suppliersTable.style.display = "none";
          emptyState.style.display = "block";
          paginationSection.style.display = "none";
          hideSupplierLoading(); // <-- Agrega esta l√≠nea
          return;
        }
        suppliersTable.style.display = "block";
        emptyState.style.display = "none";
        paginationSection.style.display = "block";
        const startIndex = (supplierCurrentPage - 1) * supplierItemsPerPage;
        const paginatedProveedores = filteredProveedores.slice(
          startIndex,
          startIndex + supplierItemsPerPage
        );
        tableBody.innerHTML = paginatedProveedores
          .map(
            (proveedor) => `
              <tr>
                <td>
                  <input type="checkbox" onchange="toggleSupplierSelection(${proveedor.id}, event)" ${
              selectedProveedores.includes(proveedor.id) ? "checked" : ""
            }>
                </td>
                <td>
                  <div class="supplier-info">
                    <div class="supplier-icon">üè¢</div>
                    <div class="supplier-details">
                      <h4>${proveedor.nombre}</h4>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="contact-info">
                    ‚úâÔ∏è ${proveedor.email}
                  </div>
                </td>
                <td>
                  ${proveedor.productos}
                </td>
                <td>
                  <span class="status-badge ${proveedor.activo ? "active" : "inactive"}">
                    ${proveedor.activo ? "Activo" : "Inactivo"}
                  </span>
                </td>
                <td>${formatDate(proveedor.fechaRegistro)}</td>
                <td>
                  <div class="actions-group">
                    <button class="btn-small btn-edit" onclick="openEditSupplierModal(${proveedor.id})">
                      ‚úèÔ∏è Editar
                    </button>
                    <button class="btn-small btn-toggle" onclick="toggleSupplierStatus(${proveedor.id})">
                      ${proveedor.activo ? "‚ùå" : "‚úÖ"}
                    </button>
                    <button class="btn-small btn-delete" onclick="deleteSupplier(${proveedor.id})">
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            `
          )
          .join("");
        hideSupplierLoading(); // <-- Agrega esta l√≠nea al final
        updateBulkSupplierActions();
      }

      // Modal funciones
      function openAddSupplierModal() {
        editingSupplier = null;
        document.getElementById("supplierModalTitle").textContent = "Agregar Proveedor";
        document.getElementById("saveSupplierButtonText").textContent = "Guardar Proveedor";
        clearSupplierForm();
        document.getElementById("supplierModal").style.display = "flex";
      }
      function openEditSupplierModal(id) {
        const proveedor = proveedores.find((p) => p.id === id);
        if (!proveedor) return;
        editingSupplier = proveedor;
        document.getElementById("supplierModalTitle").textContent = "Editar Proveedor";
        document.getElementById("saveSupplierButtonText").textContent = "Actualizar Proveedor";
        fillSupplierForm(proveedor);
        document.getElementById("supplierModal").style.display = "flex";
      }
      function closeSupplierModal() {
        document.getElementById("supplierModal").style.display = "none";
        editingSupplier = null;
        clearSupplierForm();
      }
      function clearSupplierForm() {
        document.getElementById("supplierName").value = "";
        document.getElementById("supplierEmail").value = "";
        document.getElementById("supplierProducts").value = "";
        document.getElementById("supplierActive").checked = true;
      }
      function fillSupplierForm(proveedor) {
        document.getElementById("supplierName").value = proveedor.nombre;
        document.getElementById("supplierEmail").value = proveedor.email;
        document.getElementById("supplierProducts").value = proveedor.productos || "";
        document.getElementById("supplierActive").checked = proveedor.activo;
      }
      function saveSupplier() {
        const form = document.getElementById("supplierForm");
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }
        const supplierData = {
          nombre: document.getElementById("supplierName").value,
          email: document.getElementById("supplierEmail").value,
          productos: document.getElementById("supplierProducts").value,
          activo: document.getElementById("supplierActive").checked,
          fechaRegistro: editingSupplier ? editingSupplier.fechaRegistro : new Date(),
        };
        if (editingSupplier) {
          supplierData.id = editingSupplier.id;
          const index = proveedores.findIndex((p) => p.id === editingSupplier.id);
          proveedores[index] = supplierData;
        } else {
          supplierData.id = Date.now();
          proveedores.unshift(supplierData);
        }
        applySupplierFilters();
        closeSupplierModal();
      }
      function deleteSupplier(id) {
        const proveedor = proveedores.find((p) => p.id === id);
        if (!proveedor) return;
        if (!confirm(`¬øEst√° seguro de eliminar el proveedor "${proveedor.nombre}"?`)) {
          return;
        }
        proveedores = proveedores.filter((p) => p.id !== id);
        selectedProveedores = selectedProveedores.filter((selectedId) => selectedId !== id);
        applySupplierFilters();
      }
      function toggleSupplierStatus(id) {
        const proveedor = proveedores.find((p) => p.id === id);
        if (!proveedor) return;
        proveedor.activo = !proveedor.activo;
        applySupplierFilters();
      }

      // Selecci√≥n masiva
      function toggleSupplierSelection(id, event) {
        if (event.target.checked) {
          selectedProveedores.push(id);
        } else {
          selectedProveedores = selectedProveedores.filter((selectedId) => selectedId !== id);
        }
        updateBulkSupplierActions();
      }
      function selectAllSuppliers(event) {
        const startIndex = (supplierCurrentPage - 1) * supplierItemsPerPage;
        const paginatedProveedores = filteredProveedores.slice(
          startIndex,
          startIndex + supplierItemsPerPage
        );
        if (event.target.checked) {
          selectedProveedores = [
            ...new Set([
              ...selectedProveedores,
              ...paginatedProveedores.map((p) => p.id),
            ]),
          ];
        } else {
          const currentPageIds = paginatedProveedores.map((p) => p.id);
          selectedProveedores = selectedProveedores.filter(
            (id) => !currentPageIds.includes(id)
          );
        }
        updateBulkSupplierActions();
        renderProveedores();
      }
      function updateBulkSupplierActions() {
        const bulkActions = document.getElementById("bulkSupplierActions");
        const selectedCount = document.getElementById("selectedSupplierCount");
        if (selectedProveedores.length > 0) {
          bulkActions.style.display = "flex";
          selectedCount.textContent = selectedProveedores.length;
        } else {
          bulkActions.style.display = "none";
        }
        // Actualizar checkbox "Seleccionar todo"
        const selectAllCheckbox = document.getElementById("selectAllSuppliers");
        const startIndex = (supplierCurrentPage - 1) * supplierItemsPerPage;
        const paginatedProveedores = filteredProveedores.slice(
          startIndex,
          startIndex + supplierItemsPerPage
        );
        const currentPageIds = paginatedProveedores.map((p) => p.id);
        const allCurrentSelected = currentPageIds.every((id) =>
          selectedProveedores.includes(id)
        );
        selectAllCheckbox.checked = allCurrentSelected && currentPageIds.length > 0;
      }
      function bulkActivateSuppliers() {
        if (selectedProveedores.length === 0) return;
        selectedProveedores.forEach((id) => {
          const proveedor = proveedores.find((p) => p.id === id);
          if (proveedor) proveedor.activo = true;
        });
        selectedProveedores = [];
        applySupplierFilters();
      }
      function bulkDeactivateSuppliers() {
        if (selectedProveedores.length === 0) return;
        selectedProveedores.forEach((id) => {
          const proveedor = proveedores.find((p) => p.id === id);
          if (proveedor) proveedor.activo = false;
        });
        selectedProveedores = [];
        applySupplierFilters();
      }
      function bulkDeleteSuppliers() {
        if (selectedProveedores.length === 0) return;
        if (
          !confirm(
            `¬øEst√° seguro de eliminar ${selectedProveedores.length} proveedores?`
          )
        ) {
          return;
        }
        proveedores = proveedores.filter((p) => !selectedProveedores.includes(p.id));
        selectedProveedores = [];
        applySupplierFilters();
      }

      // Filtros
      function onSupplierSearchChange() {
        applySupplierFilters();
      }
      function onSupplierStatusFilterChange(event) {
        applySupplierFilters();
      }
      function clearSupplierFilters() {
        document.getElementById("supplierSearchInput").value = "";
        document.getElementById("supplierStatusFilter").value = "all";
        applySupplierFilters();
      }

      // Paginaci√≥n
      function goToSupplierPage(direction) {
        if (direction === "prev" && supplierCurrentPage > 1) {
          supplierCurrentPage--;
        } else if (direction === "next" && supplierCurrentPage < supplierTotalPages) {
          supplierCurrentPage++;
        }
        selectedProveedores = [];
        updateSupplierPagination();
        renderProveedores();
      }

      // Auxiliares
      function formatDate(date) {
        return new Date(date).toLocaleDateString("es-ES", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }
      function showSupplierLoading() {
        document.getElementById("loadingSuppliers").style.display = "flex";
        document.getElementById("suppliersTable").style.display = "none";
        document.getElementById("emptySupplierState").style.display = "none";
      }
      function hideSupplierLoading() {
        document.getElementById("loadingSuppliers").style.display = "none";
      }
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeSupplierModal();
        }
      });
    </script>
  </body>
</html>
